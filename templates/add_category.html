{% extends 'base.html' %}
{% block content %}
<div class="space-y-6">
    <h1 class="text-2xl font-bold">Manage Budget</h1>

    <form method="POST" class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 space-y-4">
        <input type="text" name="name" placeholder="Category Name (e.g. Food)" class="w-full p-4 bg-slate-50 rounded-2xl outline-none" required>
        <input type="number" step="0.01" name="amount" placeholder="Monthly Allocation" class="w-full p-4 bg-slate-50 rounded-2xl outline-none" required>
        <button type="submit" class="w-full bg-indigo-600 text-white p-4 rounded-2xl font-bold">Create Category</button>
    </form>

    <div class="space-y-4">
        <p class="font-bold text-slate-500 ml-1">Your Categories</p>
        {% for cat in categories %}
        <div class="bg-white border border-slate-100 rounded-3xl overflow-hidden shadow-sm">
            <div id="view-{{ cat.id }}" class="p-5 flex items-center justify-between">
                <div>
                    <p class="font-bold text-slate-800">{{ cat.name }}</p>
                    <p class="text-xs text-slate-400">Allocated: ${{ "{:,.2f}".format(cat.allocated_amount) }}</p>
                </div>
                <div class="flex space-x-2">
                    <button onclick="toggleEdit('{{ cat.id }}')" class="p-2 text-indigo-600 bg-indigo-50 rounded-xl">Edit</button>
                    <form action="{{ url_for('delete_category', id=cat.id) }}" method="POST" onsubmit="return confirm('Delete category?');">
                        <button type="submit" class="p-2 text-red-500 bg-red-50 rounded-xl">Delete</button>
                    </form>
                </div>
            </div>

            <div id="edit-{{ cat.id }}" class="hidden p-5 bg-slate-50 border-t border-slate-100">
                <form action="{{ url_for('edit_category', id=cat.id) }}" method="POST" class="space-y-3">
                    <input type="text" name="name" value="{{ cat.name }}" class="w-full p-3 rounded-xl border-none shadow-sm" required>
                    <input type="number" step="0.01" name="amount" value="{{ cat.allocated_amount }}" class="w-full p-3 rounded-xl border-none shadow-sm" required>
                    <div class="flex space-x-2">
                        <button type="submit" class="flex-1 bg-indigo-600 text-white py-2 rounded-xl text-sm font-bold">Save</button>
                        <button type="button" onclick="toggleEdit('{{ cat.id }}')" class="flex-1 bg-white text-slate-500 py-2 rounded-xl text-sm font-bold border border-slate-200">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
function toggleEdit(id) {
    document.getElementById(`view-${id}`).classList.toggle('hidden');
    document.getElementById(`edit-${id}`).classList.toggle('hidden');
}
</script>
{% endblock %}